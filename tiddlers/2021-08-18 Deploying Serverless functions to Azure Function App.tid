created: 20210818131137787
modified: 20220601014918719
published: 20210818142837835
tags: Azure Serverless GitHub blog $:/plugins/adithyab/tiddlyjam/live
title: 2021-08-18 Deploying Serverless functions to Azure Function App
type: text/vnd.tiddlywiki

Serverless functions æˆ‘å·²ç»ç©çš„æœ‰ç‚¹çƒ¦äº†ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½ç”¨ä¸åŒçš„ Cloudï¼Œæ¯æ¬¡éƒ½è¦å˜åŒ–å·¥ä½œæµã€‚åŸæœ¬æœŸå¾…ä¸€åŠ³æ°¸é€¸çš„ Serverless Framework å¼±çš„ä¸è¡Œï¼Œk8s æœ‰æ„Ÿè§‰æ˜¯æ€é¸¡ç”¨ç‰›åˆ€ã€‚éš¾å—ğŸ˜£

ç®—äº†ï¼Œä¸æäº†ï¼Œè¿›å…¥æ­£æ–‡ã€‚

è¿™ä¸€æ¬¡æ˜¯ Azure Function Appï¼Œæˆ‘æƒ³è®°å½•ä¸€ä¸‹å¦‚ä½•éƒ¨ç½² Serverless functions åˆ° Azure Function Appï¼Œå¹¶æ”¯æŒ Deployment slots åšä¸€ä¸‹ A/B testingã€‚

ä¸¤ç§æ–¹å¼

# VSCode Extension
# GitHub Actions

!!!! 1. VSCode Extension

ä½¿ç”¨ VSCode Extension éƒ¨ç½² Azure Function App éå¸¸æ–¹ä¾¿ï¼Œä¹Ÿæ˜¯æˆ‘å¼€å‘æ—¶æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚
VSCode Extension ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œä»‹ç»ä¸€ç‚¹ç‰¹æ®Šçš„ï¼Œå®˜æ–¹æ–‡æ¡£æ²¡æœ‰æ•™çš„å†…å®¹ã€‚

å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œæ‰“ç®—ä½¿ç”¨ Deployment slots åš `A/B testing`ã€‚

VSCode Extension çš„èœå•å°±æ¯”è¾ƒæ·±äº†

[img[https://i.gyazo.com/a00e30807af5d3a3f6cd6c402096c8d2.jpg]]

æ­£ç¡®çš„éƒ¨ç½²èœå•

[img[https://i.gyazo.com/97e914f00f711cbeb9dffc344b997d8b.jpg]]

!!!! 2. GitHub Actions

ç”±äº MicroSoft è´¢å¤§æ°”ç²—ï¼Œå·²ç»å°† GitHub æ”¶å…¥éº¾ä¸‹ï¼ŒAzure Function App ä¹Ÿæ”¯æŒä½¿ç”¨ GitHub Actions éƒ¨ç½²ã€‚

Azure Portal UI 

[img[https://i.gyazo.com/be02ad6fc63897f26a5a67fd3b5419a4.jpg]]

ä¸è¿‡ï¼Œå¾ˆé—æ†¾ï¼Œåªé€šè¿‡ Azure Portal UI ä½ å¹¶ä¸èƒ½æˆåŠŸéƒ¨ç½²ä½ çš„ functionsã€‚é™¤éä½ ç¼–å†™äº†ä¸€ä¸ª [[hello world]]

ä¼°è®¡ä½ ä¹Ÿä¼šé‡åˆ°ä¸‹é¢å‡ ä¸ªé—®é¢˜

# `Error: package.json not found.`
# `Error: Package deployment using ZIP Deploy failed. Refer logs for more details.`
# HTTP `CORS`

æ€ä¹ˆè§£å†³ï¼Ÿ

1.  `Error: package.json not found.`

è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸æ˜¯å› ä¸ºä½ çš„ serverless functions å¹¶ä¸åœ¨æ ¹ç›®å½•ï¼ˆrootï¼‰ï¼Œä½ éœ€è¦åœ¨ yaml æ–‡ä»¶ä¸­é…ç½® `package`

```yml
    - name: 'Run Azure Functions Action'
      uses: Azure/functions-action@v1.3.2
      id: fa
      with:
        app-name: 'smartcompany-admin'
        package: './functions'
```

2.   `Error: Package deployment using ZIP Deploy failed. Refer logs for more details.`

è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸º Azure Function App Deployment é»˜è®¤æ˜¯ä» Azure Storage è·å–æºç ã€‚è€Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ GitHubã€‚

ä½ éœ€è¦åˆ é™¤ Azure Function App ç¯å¢ƒå˜é‡

[img[https://i.gyazo.com/bf40ad3c5ef02cb74840ebec66058d3a.jpg]]

3.  HTTP `CORS`

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§ï¼Œä½†å¾ˆå¤šåˆçº§ç¨‹åºå‘˜å§‹ç»ˆæä¸æ¸…æ¥šçš„é—®é¢˜ã€‚

è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ  Allowed Origins

[img[https://i.gyazo.com/d8096b2ee786c6be7cf39d54da5ae068.jpg]]

!!!! GitHub Actions å¦‚ä½•æ”¯æŒ Deploy slotsï¼Ÿ

ä½ éœ€è¦åœ¨ yaml æ–‡ä»¶ä¸­é…ç½® `slot-name`

```yml
    - name: 'Run Azure Functions Action'
      uses: Azure/functions-action@v1.3.2
      id: fa
      with:
        app-name: 'smartcompany-admin'
        slot-name: 'dev'
        package: './functions'
```

åˆæ˜¯ä¸€ç¯‡ç¬”è®°ã€‚

æœ€è¿‘æˆ‘è´Ÿè´£çš„é¡¹ç›®å·²ç»è¿›å…¥å‘å¸ƒå‰çš„å‡†å¤‡é˜¶æ®µï¼Œä¸€å¤§å † [[DevOps]] çš„å·¥ä½œè¦åšï¼Œå›¢é˜Ÿç¼ºå°‘ DevOps ä¸“å®¶ï¼Œæ²¡æœ‰åŠæ³•åªèƒ½è‡ªå·±ä¸Šäº†ã€‚

è¿˜åšäº†ä¸€ä¸ªç®€å•çš„ service management Systemï¼Œç­‰é¡¹ç›®å‘å¸ƒäº†ï¼Œæ‰“ç®—æ•´ç†ä¸€ä¸‹ï¼ˆç§»é™¤æ•æ„Ÿå†…å®¹ï¼‰åå¼€æºå‡ºæ¥ã€‚

----

links

* https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions
