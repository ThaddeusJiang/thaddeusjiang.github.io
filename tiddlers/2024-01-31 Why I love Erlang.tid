created: 20240131030239275
modified: 20240131133729628
published: 20240131130543395
tags: blog $:/plugins/adithyab/tiddlyjam/live
title: 2024-01-31 Why I love Erlang
type: text/vnd.tiddlywiki

æˆ‘æƒ³èµ·äº†ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹ä¸­çš„ä¸€æ®µè¯ï¼šâ€œç¼–ç¨‹è¯­è¨€ä¸ä¸€æ ·ï¼Œä¸å…¶è¯´å®ƒæ˜¯æŠ€æœ¯ï¼Œè¿˜ä¸å¦‚è¯´æ˜¯ç¨‹åºå‘˜çš„æ€è€ƒæ¨¡å¼ã€‚ç¼–ç¨‹è¯­è¨€æ˜¯æŠ€æœ¯å’Œå®—æ•™çš„æ··åˆç‰©ã€‚â€

!! Why I love Erlang

è¿™æœ¬èº«å°±ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå–œæ¬¢æŸä¸ªç¼–ç¨‹è¯­è¨€å°±åƒå–œæ¬¢æŸä¸ªå…·ä½“çš„äººä¸€æ ·ï¼Œé‚£æ˜¯ä¸€ç§æ„Ÿè§‰ï¼Œæ ¹æœ¬ä¸éœ€è¦å…·ä½“çš„ç†ç”±ã€‚

å¤šå¹´æ¥ï¼Œæˆ‘ä¸€ç›´å¾ˆå‘å¾€ DHH å› ä¸ºä»–å¾ˆæ—©æ‰¾åˆ°äº†ä»–å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€ Rubyã€‚æˆ‘å°è¯•è¿‡å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ï¼šJavaã€JSã€Perlã€Swiftã€ResonML ç­‰ç­‰ï¼Œå¾ˆé—æ†¾å®ƒä»¬éƒ½æ²¡æœ‰è®©æˆ‘æœ‰ soulmate çš„æ„Ÿè§‰ã€‚å‡ å¹´å‰å¶ç„¶çš„æœºä¼šï¼Œæˆ‘äº†è§£åˆ° Elixirï¼Œä»¥åŠæ–­æ–­ç»­ç»­åœ°ä½¿ç”¨è¿‡ç¨‹ä¸­åˆäº†è§£åˆ° Erlangï¼Œç¼–å†™ Erlang/Elixir ä»£ç è®©æˆ‘æœ‰äº†ä¹…è¿çš„æ„‰æ‚¦æ„Ÿã€‚

æˆ‘æ„ˆå‘åœ°æ˜æ™°äº† Erlang/Elixir æ˜¯æˆ‘çœŸæ­£çš„ soulmate languageï¼Œæˆ‘å¤ªå–œæ¬¢å®ƒä»¬äº†ã€‚å¸Œæœ›æˆ‘å¯ä»¥åƒ DHH å¯¹ Ruby ä¸€æ ·ï¼Œä¸º Erlang/Elixir åšä¸€äº›è´¡çŒ®ã€‚

!! è™½ç„¶äº‹å®å¦‚ä¸Šï¼Œä½†æ˜¯æˆ‘ä¹Ÿå¯ä»¥åˆ—å‡ºä¸€äº›å…·ä½“çš„ç‚¹è¯´æ˜ä¸ºä»€ä¹ˆæˆ‘å–œæ¬¢ Erlangã€‚

> æˆ‘ä¸å¤ªç¡®å®šåº”è¯¥æŒ‰ç…§ Erlang çš„å¼ºé¡¹å¼€å§‹å†™ï¼Œè¿˜æ˜¯æŒ‰ç…§é˜…è¯»è¿™ç¯‡æ–‡ç« çš„æœ‹å‹å¯ä»¥å­¦ä¹ æ›²çº¿å¼€å§‹å†™ã€‚
> æš‚æ—¶å…ˆæŒ‰ç…§å®¹æ˜“ç†è§£çš„é¡ºåºå¼€å§‹å†™å§ã€‚

TR;DR

# Erlang è®©ç¨‹åºå›å½’æ•°å­¦
# Erlang æ•´æ•°ä¸ä¼šæº¢å‡º
# Erlang æä¾›å®Œç¾çš„å­—é¢é‡å¯¹è±¡
# Erlang è¿œç¨‹è°ƒç”¨å’Œæœ¬åœ°è°ƒç”¨ä¸€æ ·ç®€å•
# Erlang è¿œç¨‹å¤„ç†é”™è¯¯å…è®¸ä¼˜é›…åœ°å¯¹åº”ä¸å¯æŠ—åŠ›å› ç´ 
# Erlang åœ¨è¯­è¨€å±‚é¢æä¾›äº†åŠŸèƒ½å¼ºå¤§çš„ Schemaless Database

!! 1. Erlang è®©ç¨‹åºå›å½’æ•°å­¦

åˆ—ä¸¾è®¡ç®—æœºç¼–ç¨‹é—®é¢˜ä¸­å¸¸è¢«æåˆ°çš„ä¸¤ä¸ªç®—æ³•æ–æ³¢æ‹‰åˆ‡æ•°å’Œå¿«é€Ÿæ’åºã€‚

æ–æ³¢é‚£å¥‘æ•°ï¼š

```erl
fib(0) -> 0;
fib(1) -> 1;
fib(X) -> fib(X-1) + fib(X-2).
```

å¿«é€Ÿæ’åº

```erl
sort([]) -> [];
sort([Pivot|Rest]) ->
    {Smaller, Larger} = lists:partition(fun(X) -> X < Pivot end, Rest),
    sort(Smaller) ++ [Pivot] ++ sort(Larger).
```

æˆ‘æƒ³åº”è¯¥æ²¡æœ‰å…¶ä»–ç¼–ç¨‹è¯­è¨€å¯ä»¥åšåˆ°åƒ Erlang è¿™æ ·æ—¢ä¼˜é›…åˆç®€æ´äº†å§ã€‚æœ€é‡è¦çš„æ˜¯ Erlang ç¼–å†™çš„ä»£ç å’Œæ•°å­¦ä¸Šçš„å®šä¹‰å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œå¤ªæ£’äº†ã€‚

å†åˆ†äº«ä¸€ä¸ªç®€å•çš„æ±‚é¢ç§¯çš„å‡½æ•°

```erl
area({rectangle, Width, Ht}) -> Width * Ht;
area({circle, R}) Â  Â  Â  Â  Â  Â -> 3.14 * R * R.

area({circle, 14}). % 615.44
```

Erlang æä¾›çš„å‡½æ•°å‚æ•°æ¨¡å¼åŒ¹é…è®©ä»£ç å¯ä»¥å‡å°‘å¾ˆå¤šæ¡ä»¶åˆ¤æ–­ï¼Œä¾‹å¦‚ï¼š if (rectangle) then ... else if (circle) then ... ç­‰ç­‰ã€‚

!! 2. Erlang æ•´æ•°ä¸ä¼šæº¢å‡º

```erl
1234567890 * 9876543210.
% 12193263111263526900
```

ç›¸ä¿¡æ‰€æœ‰å¼€å‘è€…éƒ½çŸ¥é“ç¼–ç¨‹é¢†åŸŸç»•ä¸å¼€çš„å°±æ˜¯æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Œå¦‚ï¼š0.1 +  0.2 ä¸ç­‰äº 0.3ã€‚

è™½ç„¶ Erlang ä¹Ÿæ²¡æœ‰åŠæ³•é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å’Œå…¶ä»–ç¼–ç¨‹æŠ€å·§ä¸€æ ·ä¹Ÿæ˜¯å…ˆä½¿ç”¨æ•´æ•°è¿›è¡Œæ•°å­¦è¿ç®—å†é™¤ä»¥ä½æ•°ï¼›ä½†æ˜¯æ•´æ•°ä¸æº¢å‡ºå¯ä»¥å°†è¿ç®—èŒƒå›´å’Œç²¾åº¦æå‡åˆ°å…¶ä»–ç¼–ç¨‹è¯­è¨€æ— æ³•æ¯”æ‹Ÿçš„æ°´å¹³ã€‚é‡è¦çš„æ˜¯ï¼Œè¿™æ˜¯è¯­è¨€é»˜è®¤æä¾›çš„èƒ½åŠ›ï¼Œä¸éœ€è¦é¢å¤–å®‰è£…ä¾èµ–ã€‚


!! 3. Erlang æä¾›å®Œç¾çš„å­—é¢é‡å¯¹è±¡

<<<.tc-big-quote
Less, but better.
<<<Rams

Erlang ä¸­è¿”å›ä¸€ä¸ª person æ•°æ®

```erl
{person, {tj, 31, male}}
```

è™½ç„¶æˆ‘å¾ˆå–œæ¬¢ JSONï¼Œç›¸è¾ƒäº Erlang tuple ï¼Œè¿˜æ˜¯æœ‰ç‚¹ç¹çäº†ã€‚

```json
{
    "name": "tj",
    "age": 31,
    "gender": "male"
}
```

Erlang Records æä¾›æ›´åŠ æ˜ç¡®å±æ€§åï¼Œæˆ–è®¸å¤§å®¶æ›´äº²åˆ‡ã€‚

```erl
-record(person, {name, phone, address}).

P = #person{name="tj"}
#person{name = N} = P.

N. % "tj"
```

--- ä¸‹é¢åˆ†äº«ä¸€äº› Erlang æ›´é«˜çº§çš„åŠŸèƒ½ ---

!! 4. Erlang åœ¨è¯­è¨€å±‚é¢æä¾›è¿œç¨‹è°ƒç”¨ï¼ŒåŸç”Ÿæ”¯æŒåˆ†å¸ƒå¼

Erlang å…è®¸ç›´æ¥é€šè¿‡ node è°ƒç”¨è¿œç¨‹ä»£ç ï¼Œåœ¨è¯­è¨€å±‚é¢æ”¯æŒåˆ†å¸ƒå¼ã€‚

æˆ‘ä»¬å‡†å¤‡ä¸€æ®µä»£ç 

```erl
% math.erl
-module(math).
-export([add/2]).

add(X, Y) ->
    X + Y.
```

ç„¶ååœ¨ä»£ç ç›®å½•ä¸‹å¼€å¯ä¸€ä¸ª terminalï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªæŒ‡å®šåç§°çš„ erl 

```
erl -sname left

node().
% 'left@2022-M2-Air'
```

ç¼–è¯‘ä»£ç ï¼Œå¹¶æµ‹è¯•ä¸€ä¸‹ä»£ç æ˜¯å¦å·¥ä½œ

```erl
c(math).
% {ok,math}
math:add(1,2).
% 3
```

åœ¨ `ä»»æ„ç›®å½•` ä¸‹å¼€å¯ `å¦ä¸€ä¸ª terminal`ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªæŒ‡å®šåç§°çš„ erl 

```erl
erl -sname right

node().
% 'right@2022-M2-Air'
```

ç°åœ¨æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»äº†ã€‚è™½ç„¶åœ¨ right terminal æ²¡æœ‰ math.erl ä»£ç ï¼Œ
Erlang å…è®¸æˆ‘ä»¬ç›´æ¥è°ƒç”¨è¿œç¨‹èŠ‚ç‚¹çš„ä»£ç 

```erl
math:add(1,2).
% ** exception error: undefined function math:add/2

rpc:call('left@2022-M2-Air', math, add, [1,2]).
% 3
```

!! 5. Erlang è¿œç¨‹å¤„ç†é”™è¯¯å…è®¸ä¼˜é›…åœ°å¯¹åº”ä¸å¯æŠ—åŠ›å› ç´ 

> è¿œç¨‹å¤„ç†é”™è¯¯è¿™ä¸æ˜¯å¾®æœåŠ¡æ¶æ„çš„ç»ˆæç›®æ ‡å—ï¼Ÿ

å‡†å¤‡ä¸¤ä¸ª server side ä»£ç ï¼Œserver1 è´Ÿè´£é€»è¾‘ï¼Œserver2 è´Ÿè´£é”™è¯¯å¤„ç†ã€‚

```erl
% server1.erl
-module(sever1).
-export([run/0]).

run() ->
    receive
        X -> list_to_atom(X)
    end.
```

```erl
% server2.erl
-module(server2).
-export([listen/1]).

listen(Pid) ->
    spawn(fun() ->
        process_flag(trap_exit, true),
        link(Pid),
        receive
            {'EXIT', Pid, _} -> io:format(" ~p died. ~n", [Pid])
        end
    end).
```

æ‰“å¼€ä¸€ä¸ª terminal å¹¶ç¼–è¯‘ server1

```erl
erl -sname server1

c(server1).
```

æ‰“å¼€å¦å¤–ä¸€ä¸ª terminalï¼Œå¹¶ç¼–è¯‘ server2

```erl
erl -sname server2

c(server2).
```

åœ¨ terminal 2 ä¸­

```erl
% åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æŒ‡å‘ server1 run å‡½æ•°
Pid = spawn('server1@2022-M2-Air', server1, run, []).

% ç»‘å®šçº¿ç¨‹å’Œé”™è¯¯å¤„ç†å‡½æ•°
server2:listen(Pid).

% å‘çº¿ç¨‹å‘é€æ¶ˆæ¯
Pid ! hello.
```

è¿™æ—¶ terminal 2 ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡º

```erl
<10155.111.0> died. 
```

so cool.

è§£é‡Šä¸€ä¸‹ï¼Œè™½ç„¶ç¨‹åºå¼‚å¸¸æ˜¯åœ¨ terminal 1 å‘ç”Ÿçš„ï¼Œä½†æ˜¯å¤„ç†ç¨‹åºå´åªåœ¨ terminal 2 ä¸­è¢«å®šä¹‰ï¼Œå¹¶ä¸”åœ¨ terminal ä¸­è¢«æ‰§è¡Œã€‚

<<<.tc-big-quote
ç°åœ¨æˆ‘ä»¬å…ˆåœä¸‹æ¥ï¼Œå›å‘³ä¸€ä¸‹å‰é¢è¿™ä¸ªæ ·ä¾‹ã€‚è¿™ä¸ªæ ·ä¾‹å±•ç¤ºäº† Erlang å“²å­¦ä¸­æå…¶é‡è¦çš„ä¸€é¢â€”â€”è¿œç¨‹é”™è¯¯å¤„ç†ã€‚
<<<joe

<<<.tc-big-quote
Erlang åœ¨è¯­è¨€å±‚é¢æä¾›äº†ä¸€ä¸ª k8s
<<<TJ 2024-01-31

# 6. Erlang åœ¨è¯­è¨€å±‚é¢æä¾›äº†åŠŸèƒ½å¼ºå¤§çš„ Schemaless Database

å…¶å®æˆ‘æ²¡æœ‰ä½¿ç”¨è¿‡ Erlang è‡ªå¸¦ Mnesia databaseï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è®¡åˆ’çœŸæ­£ä½¿ç”¨ Mnesia å¼€å‘å®é™…äº§å“ã€‚ä½†æ˜¯æˆ‘å¾ˆå–œæ¬¢ ETS å’Œ DETSï¼Œåœ¨è¯­è¨€å±‚é¢æä¾› ETS DETS è¿™ç§å†…å­˜å’Œç¡¬ç›˜å‚¨å­˜æœåŠ¡çœŸçš„å¤ªæ–¹ä¾¿äº†ã€‚

è™½ç„¶ SQLite ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ ETS å¯ä»¥ç›´æ¥å­˜å‚¨ Erlang Records è¿™ç®€ç›´æ˜¯æ— æ•Œä¸€æ ·çš„å­˜åœ¨ã€‚

```erl
1> Tab = ets:new(user, [set]).
#Ref<0.2226659868.3932815361.70843>
2> ets:insert(Tab, {tj, {tj, 31, male}}).
true
3> ets:lookup(Tab, tj).
[{tj,{tj,31,male}}]
```

ä¸ºä»€ä¹ˆ Erlang ä¸­ ETS EDTS æ¯” SQLite æ›´å¥½ç”¨ï¼Ÿ

# ETS EDTS æ— éœ€é¢å¤–å®‰è£…ï¼ŒErlang VM è‡ªå¸¦
# ETS EDTS æ”¯æŒå­˜å‚¨ Erlang Recordsï¼ŒåŸç”Ÿå¯¹è±¡ï¼Œæ›´é«˜æ•ˆï¼Œæ— éœ€é¢å¤–è½¬æ¢
# ETS EDTS æ”¯æŒå­˜å‚¨ä»»ä½• Erlang Recordsï¼Œå³ä½¿æ˜¯åµŒå¥—æ•°æ®ï¼Œç›¸å½“äºä¸€ä¸ª NoSQL databaseã€‚

å…ˆå†™åˆ°è¿™å§ï¼Œå¦‚æœä½ æƒ³å°è¯• Erlangï¼Œæˆ–è€…æœ‰ Erlang ç›¸å…³è®¨è®ºæƒ³è¦æ‰¾äººèŠèŠï¼Œæ¬¢è¿æ¥æ‰¾æˆ‘ï¼ŒğŸ˜

<<<.tc-big-quote
I love Elixir too, Elixir runs on the Erlang VM and has a lot of beautiful features and awesome developers.
<<<TJ 2024-01-31
