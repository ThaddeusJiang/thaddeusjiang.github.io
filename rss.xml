<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   <title>ThaddeusJiang's Blog</title>
   <link>https://thaddeusjiang.com</link>
   <description></description>
   <item>
      <title>2024-09-30 I Analyzed My Browser History</title>
      <link>https://thaddeusjiang.com/2024-09-30-i-analyzed-my-browser-history</link>
			<description><![CDATA[
<div class="container mt-4">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2"><nav aria-label="main navigation" class="navbar" role="navigation"><p><div>
        <h1 class="brand">
          <a class="title" href="./">ThaddeusJiang's Blog</a>
        </h1>
        <p class="subtitle is-size-6 is-italic"></p>
      </div>
      
      <div class="navbar-end mt-2">
        <a class="tc-tiddlylink tc-tiddlylink-shadow tc-tiddlylink-resolves" href="./#blog">Blog</a> | <a class="tc-tiddlylink tc-tiddlylink-missing" href="./#wiki">Wiki</a> | <a class="tc-tiddlylink-external" href="https://thaddeusjiang.com/rss.xml" rel="noopener noreferrer" target="_blank">RSS</a>
      </div></p></nav></div>
</div>


<div class="container">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2">
      <div>
          <h1 class="title">2024-09-30 I Analyzed My Browser History</h1>
          <hr>

          <div class="content">
            <p>å¿ƒè¡€æ¥æ½®ï¼Œæˆ‘å°è¯•åˆ†æäº†æˆ‘çš„æµè§ˆå™¨è®°å½•ï¼Œå‘ç°äº†ä¸€ç‚¹ç‚¹â€œä¸å¾—äº†çš„â€äº‹æƒ…ã€‚</p><blockquote><div>TL;DR</div></blockquote><ul><li>æˆ‘æœ‰ 411k è®¿é—®è®°å½•ï¼Œåªæœ‰ 27k ä¸»åŠ¨è®¿é—®ï¼Œå æ¯”ä»… 5%</li><li>æˆ‘ç«Ÿç„¶è®¿é—®è¿‡ 63 ä¸ª Google æä¾›çš„æœåŠ¡</li><li>Open Source in <a class="tc-tiddlylink-external" href="https://github.com/ThaddeusJiang/history_analytics" rel="noopener noreferrer" target="_blank">https://github.com/ThaddeusJiang/history_analytics</a></li></ul><p>æ­£æ–‡ï¼š</p><p>é¦–å…ˆï¼Œåˆ†æçš„æ•°æ®æ¥è‡ªæˆ‘çš„ Arc Browserï¼Œæˆ‘ä» 2023 å¹´å¼€å§‹ä½¿ç”¨ Arc Browser ä½œä¸ºä¸»åŠ›æµè§ˆå™¨ï¼Œä¹‹å‰çš„æ•°æ®åœ¨ Brave Browser ä¸­ï¼Œæˆ‘è¿™æ¬¡æ²¡æœ‰åˆ†ææ—§çš„æµè§ˆå™¨è®°å½•ã€‚</p><p>æˆ‘åˆ†æäº† 411,345 æ¡è®¿é—®è®°å½•ï¼Œå…¶ä¸­åŒ…å« 100,585 URLs å’Œ 27,687 æ¬¡ä¸»åŠ¨è®¿é—®ï¼›è™½ç„¶æˆ‘æ„Ÿè§‰è‡ªå·±å·²ç»å¾ˆä¹…æ²¡æœ‰è®¿é—® Google æœç´¢äº†ï¼Œä½†æ˜¯ä»æ•°æ®ä¸Šçœ‹ Google ä¾ç„¶æ˜¯æˆ‘ä½¿ç”¨æœ€å¤šçš„æœç´¢å¼•æ“ï¼Œå å…¨éƒ¨è®¿é—®é‡çš„ 7.23%ã€‚</p><blockquote><div>å“ˆå“ˆå“ˆ å’Œæˆ‘çš„è®°å¿†æœ‰ä¸€ç‚¹ç‚¹å‡ºå…¥ã€‚</div></blockquote><p><img class=" tc-image-loading" src="https://i.gyazo.com/4c20064b7de83e1b16a6d19f9b5ab9ef.png"></p><p>åœ¨æˆ‘å…¨éƒ¨è®¿é—®è®°å½•é‡Œï¼Œè®¿é—®é‡æœ€å¤§çš„æœåŠ¡/åŸŸåä¾æ¬¡æ˜¯</p><ul><li>github.com</li><li>google.com</li><li>localhost</li><li>twitter.com</li><li>...</li></ul><h2 class="">GitHub</h2><p>ä»æ•°æ®ä¸Šçœ‹ï¼Œä¸€å…±è®¿é—® GitHub 92,340 æ¬¡ï¼ŒæŸ¥çœ‹è¿‡ 2,271 Repositoriesã€‚æœ€è¿‘å·¥ä½œçš„ repository è®¿é—®é‡ä¸€éª‘ç»å°˜ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æˆ‘çš„ä¸ªäººé¡¹ç›®äº†ã€‚</p><p><img class=" tc-image-loading" src="https://i.gyazo.com/9f9d7ec1b9ad3a45db7126d22874b4a7.png"></p><p>æ’é™¤ Personal and Work Projectsï¼Œæˆ‘è®¿é—®æœ€å¤šçš„ open source repositories åˆ†åˆ«æ˜¯</p><ol><li>epic-stack</li><li>ex_doc</li><li>conform</li><li>blues-stack</li><li>zed</li><li>react-google-maps</li><li>...</li></ol><p>å…¶ä¸­ ex_doc, surface, ex_gram æ˜¯ elixir ç”Ÿæ€ã€‚å¾ˆé«˜å…´è‡ªå·±è¶Šæ¥è¶Šå¤šçš„ä½¿ç”¨ elixir äº†ã€‚</p><h2 class="">Google</h2><p>æˆ‘ä¸€å…±è®¿é—® Google ç›¸å…³æœåŠ¡ 78,999 æ¬¡ï¼Œè®©æˆ‘æ„Ÿåˆ°éœ‡æƒŠçš„æ˜¯æˆ‘ç«Ÿç„¶ä½¿ç”¨äº† Google 63 ç§ç½‘ç»œæœåŠ¡ï¼ŒğŸ¤¯</p><blockquote><div>æˆ‘ç”šè‡³ä¸çŸ¥é“ Google æœ‰è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒğŸ˜‚</div></blockquote><p><img class=" tc-image-loading" src="https://i.gyazo.com/692754ba6797359b330a4562cf507f99.png"></p><h2 class="">Localhost</h2><p>localhost æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œä½œä¸ºç¨‹åºå‘˜ï¼Œè®¿é—®å¤šå¾ˆåˆç†ã€‚</p><p>3000 æ˜¯ JS web frameworks å¸¸ç”¨çš„ç«¯å£ï¼Œ8000 ç³»æ˜¯ server å¸¸ç”¨ç«¯å£ã€‚</p><p><img class=" tc-image-loading" src="https://i.gyazo.com/8414f853e694d80aeeab574bc0c94b98.png"></p><h2 class="">Twitter</h2><p>ä¸€å…±è®¿é—® Twitter 21,953 æ¬¡ï¼Œå…¶ä¸­ä¸»åŠ¨è®¿é—® 2,304 æ¬¡ã€‚</p><p>æˆ‘åˆ†æäº†æˆ‘å¸¸å…³æ³¨çš„æ¨æ²¹ï¼Œæˆ‘çœ‹è¿‡ 1,327 ä½æ¨æ²¹çš„æ¨æ–‡ï¼Œ
æœ€å¸¸å…³æ³¨çš„ä¾æ¬¡æ˜¯ yihong0618, mieisgood, disksing, nishuang ç­‰ã€‚</p><blockquote><div>å…¶å® Twitter æ•°æ®å¾ˆæœ‰æ„æ€ï¼Œæœ‰æ—¶é—´çš„æ—¶å€™ï¼Œæˆ‘è¿˜æƒ³çŸ¥é“è‡ªå·±è®¿é—® twitter çš„æœˆåº¦æ¬¡æ•°ï¼Œæ˜ŸæœŸåˆ†å¸ƒï¼Œæ—¶é—´åˆ†å¸ƒç­‰ç­‰ã€‚</div></blockquote><p><img class=" tc-image-loading" src="https://i.gyazo.com/6d520eb16f16b215ef94273f84a7a0a7.png"></p><h2 class="">Others</h2><p>åœ¨åˆ†ææµè§ˆè®°å½•æ—¶ï¼Œæˆ‘æ„è¯†åˆ°å¯¹äºå¤§å¤šæ•°ç½‘å‹æˆ–è€…ç¨‹åºå‘˜æ¥è¯´ï¼Œå¯èƒ½å¤§å®¶è®¿é—® top10 çš„æœåŠ¡éƒ½å¤§åŒå°å¼‚ã€‚æˆ–è®¸å»é™¤æœ€æœ€å¸¸è§çš„æœåŠ¡ï¼Œtop 11~20 æ‰èƒ½åæ˜ å‡ºå¤§å®¶çš„ä¸åŒã€‚</p><p>æˆ‘çš„ top 11 ~ 20</p><ul><li>notion.so</li><li>vercel.com</li><li>www.aier.com</li><li>datadoghq.com</li><li>accounts.google.com </li><li>atlassian.net</li><li>fly.io</li><li>youtube.com</li><li>remix.run</li><li>openai.com</li></ul><h2 class="">æœ€å</h2><p>é‡åˆ°çš„å‡ ä¸ªå°é—®é¢˜ï¼š</p><p>1. Chromium ç³»åˆ—æµè§ˆå™¨ History ä½¿ç”¨ SQLite å­˜å‚¨æµè§ˆè®°å½•ï¼Œä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œå¯¼è‡´åˆå¹¶ä¸åŒæµè§ˆå™¨çš„è®°å½•ä¸æ–¹ä¾¿ï¼Œå®¹æ˜“å‡ºç°ä¸»é”®å…³è”é”™è¯¯ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘æ²¡æœ‰æš‚æ—¶æ²¡æœ‰åˆå¹¶æˆ‘çš„å¤šä¸ªæµè§ˆå™¨çš„å†å²è®°å½•ã€‚</p><p>2. SQLite é»˜è®¤ä¸æ”¯æŒ RegExpï¼Œå¤„ç† URL éº»çƒ¦ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä½¿ç”¨ pgloader å°† SQLite å¯¼å…¥åˆ° PostgreSQL æ‰è¿›è¡Œåˆ†æã€‚</p><p>3. é€šè¿‡ Metabase UI ç¼–å†™ Questions ç”Ÿæˆçš„æŸ¥è¯¢ä»£ç éš¾ä»¥é˜…è¯»ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘æ˜¯ç¼–å†™ SQL æ¥åˆ†æã€‚SQL å¯¹ developer å‹å¥½ï¼›UI å¯¹ä¸€èˆ¬ç”¨æˆ·å‹å¥½ã€‚</p><p>æˆ‘ä½¿ç”¨çš„å·¥å…·ï¼š</p><ul><li>sqlite3</li><li>psql</li><li><a class="tc-tiddlylink-external" href="https://pgloader.io/" rel="noopener noreferrer" target="_blank">https://pgloader.io/</a></li><li><a class="tc-tiddlylink-external" href="https://www.metabase.com/" rel="noopener noreferrer" target="_blank">https://www.metabase.com/</a></li></ul>
          </div>          
      </div>
  </div>
</div>     


<div class="copyright">
<strong>
<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">
ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²åï¼ˆåˆ›æ„å…±äº«3.0è®¸å¯è¯ï¼‰
</a>
</strong>
</div>

<style>
.copyright {
  padding: 0.5rem 1rem;
  text-align: center;
}

.copyright:hover {
  opacity: 0.9;
}
</style>


]]></description>
      <pubDate>Mon, 30 September 2024 5:49:5 -00:00</pubDate>
			<guid>https://thaddeusjiang.com/2024-09-30-i-analyzed-my-browser-history</guid>      
   </item>

   <item>
      <title>2024-09-25 Just use PostgreSQL</title>
      <link>https://thaddeusjiang.com/2024-09-25-just-use-postgresql</link>
			<description><![CDATA[
<div class="container mt-4">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2"><nav aria-label="main navigation" class="navbar" role="navigation"><p><div>
        <h1 class="brand">
          <a class="title" href="./">ThaddeusJiang's Blog</a>
        </h1>
        <p class="subtitle is-size-6 is-italic"></p>
      </div>
      
      <div class="navbar-end mt-2">
        <a class="tc-tiddlylink tc-tiddlylink-shadow tc-tiddlylink-resolves" href="./#blog">Blog</a> | <a class="tc-tiddlylink tc-tiddlylink-missing" href="./#wiki">Wiki</a> | <a class="tc-tiddlylink-external" href="https://thaddeusjiang.com/rss.xml" rel="noopener noreferrer" target="_blank">RSS</a>
      </div></p></nav></div>
</div>


<div class="container">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2">
      <div>
          <h1 class="title">2024-09-25 Just use PostgreSQL</h1>
          <hr>

          <div class="content">
            <p>ä¸€ä¸ªå°ä¾‹å­è§£é‡Šä¸ºä»€ä¹ˆæˆ‘é»˜è®¤é€‰æ‹© PostgreSQL è€Œä¸æ˜¯ SQLiteã€‚</p><blockquote><div>ä¸ºä»€ä¹ˆè¦è§£é‡Šï¼Ÿ</div><div>ç­”ï¼šlocal-first æœ€è¿‘åˆæµè¡Œèµ·æ¥äº†ï¼ŒJS ç¤¾åŒºçš„ Kent C. Dodds å’Œ Rails ç¤¾åŒºçš„ DHH éƒ½æ¨èä½¿ç”¨ SQLiteã€‚ä½†æ˜¯æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘æ„Ÿè§‰ SQLite ç»å¸¸èƒŒåˆºæˆ‘ã€‚</div></blockquote><h2 class="">éœ€æ±‚ï¼šä» url ä¸­æå– portï¼Œä¾‹å¦‚ï¼š<a class="tc-tiddlylink-external" href="http://localhost:3000/setup" rel="noopener noreferrer" target="_blank">http://localhost:3000/setup</a> -&gt; 3000</h2><pre class="hljs"><code class="sql hljs"># PostgreSQL
<span class="hljs-keyword">SELECT</span>
    <span class="hljs-built_in">substring</span>(url <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;:(\d+)&#x27;</span>) <span class="hljs-keyword">AS</span> port
<span class="hljs-keyword">FROM</span>
    (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;http://localhost:3000/setup&#x27;</span> <span class="hljs-keyword">AS</span> url) <span class="hljs-keyword">AS</span> t;
</code></pre><pre class="hljs"><code class="sql hljs"># SQLite
<span class="hljs-keyword">SELECT</span>
    substr(url, instr(url, <span class="hljs-string">&#x27;:&#x27;</span>) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>, instr(url, <span class="hljs-string">&#x27;/&#x27;</span>, instr(url, <span class="hljs-string">&#x27;:&#x27;</span>)) <span class="hljs-operator">-</span> instr(url, <span class="hljs-string">&#x27;:&#x27;</span>) <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> port
<span class="hljs-keyword">FROM</span>
    (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;http://localhost:3000/setup&#x27;</span> <span class="hljs-keyword">AS</span> url) <span class="hljs-keyword">AS</span> t;</code></pre><p>å¯¹æ¯”ä¹‹ä¸‹ï¼ŒPostgres çš„ substring æ¯” SQLite çš„ substr ç®€å•å¤ªå¤šäº†ï¼Œå¼€ç®±å³ç”¨çš„æ„Ÿè§‰çœŸå¥½ã€‚</p><h2 class="">å¦å¤–</h2><p>æˆ‘ä»Šå¤©å‘ç° Metabase çš„ regexextract è¡¨è¾¾å¼ä¸æ”¯æŒ SQLiteã€‚ğŸ¥²</p><p>Doc: <a class="tc-tiddlylink-external" href="https://www.metabase.com/docs/latest/questions/query-builder/expressions-list#regexextract" rel="noopener noreferrer" target="_blank">https://www.metabase.com/docs/latest/questions/query-builder/expressions-list#regexextract</a></p><h2 class="">äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨ Postgresã€‚</h2><p>refs:</p><ul><li><a class="tc-tiddlylink-external" href="https://www.epicweb.dev/why-you-should-probably-be-using-sqlite" rel="noopener noreferrer" target="_blank">https://www.epicweb.dev/why-you-should-probably-be-using-sqlite</a></li><li><a class="tc-tiddlylink-external" href="https://x.com/search?f=tweets&amp;q=sqlite+from:dhh" rel="noopener noreferrer" target="_blank">https://x.com/search?f=tweets&amp;q=sqlite+from:dhh</a></li><li><a class="tc-tiddlylink-external" href="https://x.com/search?q=Just%20use%20PostgreSQL" rel="noopener noreferrer" target="_blank">https://x.com/search?q=Just%20use%20PostgreSQL</a></li></ul>
          </div>          
      </div>
  </div>
</div>     


<div class="copyright">
<strong>
<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">
ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²åï¼ˆåˆ›æ„å…±äº«3.0è®¸å¯è¯ï¼‰
</a>
</strong>
</div>

<style>
.copyright {
  padding: 0.5rem 1rem;
  text-align: center;
}

.copyright:hover {
  opacity: 0.9;
}
</style>


]]></description>
      <pubDate>Wed, 25 September 2024 9:36:29 -00:00</pubDate>
			<guid>https://thaddeusjiang.com/2024-09-25-just-use-postgresql</guid>      
   </item>

   <item>
      <title>2024-09-18 JS wretch</title>
      <link>https://thaddeusjiang.com/2024-09-18-js-wretch</link>
			<description><![CDATA[
<div class="container mt-4">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2"><nav aria-label="main navigation" class="navbar" role="navigation"><p><div>
        <h1 class="brand">
          <a class="title" href="./">ThaddeusJiang's Blog</a>
        </h1>
        <p class="subtitle is-size-6 is-italic"></p>
      </div>
      
      <div class="navbar-end mt-2">
        <a class="tc-tiddlylink tc-tiddlylink-shadow tc-tiddlylink-resolves" href="./#blog">Blog</a> | <a class="tc-tiddlylink tc-tiddlylink-missing" href="./#wiki">Wiki</a> | <a class="tc-tiddlylink-external" href="https://thaddeusjiang.com/rss.xml" rel="noopener noreferrer" target="_blank">RSS</a>
      </div></p></nav></div>
</div>


<div class="container">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2">
      <div>
          <h1 class="title">2024-09-18 JS wretch</h1>
          <hr>

          <div class="content">
            <p>å…³äº JS HTTP request client libraryï¼Œç°é˜¶æ®µæˆ‘æ¨è wretchã€‚</p><blockquote><div>æˆ‘çš„æŠ€æœ¯æ ˆå˜åŒ–ï¼šwretch &lt;- fetch &lt;- node-fetch &lt;- axios</div></blockquote><h2 class="">æˆ‘æ¨è wretch çš„ç†ç”±ï¼š</h2><ol><li>é€‚å½“çš„å°è£…ï¼Œä¸éœ€è¦ç¼–å†™å¤§é‡ä¸šåŠ¡æ— å…³çš„ boilerplate code</li><li>ç»Ÿä¸€å®ç°çš„è¯·æ±‚æ ¼å¼ï¼Œå¦‚ï¼šè¯·æ±‚ application/json, multipart/form-data, application/x-www-form-urlencoded</li><li>å¼€ç®±å³ç”¨çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚ï¼šretry, delay, abort ç­‰ç­‰</li></ol><h2 class="">æŠ€æœ¯æ ˆå˜åŒ–ç®€è¿°</h2><ul><li>axios: ES æå‡º fetch() API å‰ï¼Œåªè®°å¾— axiosï¼ŒXMLHttpRequest æˆ‘å·²ç»ä¸è®°å¾—äº†ã€‚</li><li>node-fetch: ES æå‡º fetch() API åï¼Œä½†æ˜¯ Node.js æ²¡æœ‰å®ç°å‡ºæ¥</li><li>fetch: Node.js 18 å‘å¸ƒ fetch() API å</li><li>wretch: å†™ fetch() å¤ªç–²åŠ³äº†ï¼Œå¯»æ‰¾ç®€å•çš„å·¥å…·</li></ul><h2 class="">1. ä»€ä¹ˆæ˜¯â€œä¸éœ€è¦ç¼–å†™å¤§é‡ä¸šåŠ¡æ— å…³çš„ boilerplate codeâ€</h2><p>fetch éœ€è¦æ‰‹åŠ¨é…ç½® http methods, headers and body</p><pre><code>fetch("endpoint", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ "hello": "world" })
}).then(response =&gt; /* ... */)</code></pre><p>fetch() éœ€è¦æ‰‹åŠ¨å¤„ç† statusï¼Œå †å  if-else</p><pre class="hljs"><code class="js hljs"><span class="hljs-comment">// ğŸ˜®â€ğŸ’¨</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;anything&quot;</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-keyword">if</span>(!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-keyword">if</span>(response.<span class="hljs-property">status</span> === <span class="hljs-number">404</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Not found&quot;</span>)
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(response.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Unauthorized&quot;</span>)
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(response.<span class="hljs-property">status</span> === <span class="hljs-number">418</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;I&#x27;m a teapot !&quot;</span>)
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Other error&quot;</span>)
    }
    <span class="hljs-keyword">else</span> <span class="hljs-comment">// ...</span>
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-comment">/* ... */</span>)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> { <span class="hljs-comment">/* ... */</span> })</code></pre><blockquote><div>è€Œè¿™äº›éƒ½æ˜¯ä¸šåŠ¡æ— å…³çš„ä»£ç ï¼Œä»…ä»…æ˜¯ä¸ºäº†é…åˆ fetch() API çš„ä½¿ç”¨ã€‚</div></blockquote><p>wretch å°è£…äº†è¿™äº›ä¸šåŠ¡æ— å…³çš„ä»£ç ï¼Œè®©ä½ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚</p><pre class="hljs"><code class="js hljs"><span class="hljs-title function_">wretch</span>(<span class="hljs-string">&quot;endpoint&quot;</span>)
  .<span class="hljs-title function_">post</span>({ <span class="hljs-string">&quot;hello&quot;</span>: <span class="hljs-string">&quot;world&quot;</span> })
  .<span class="hljs-title function_">notFound</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> { <span class="hljs-comment">/* ... */</span> })
  .<span class="hljs-title function_">unauthorized</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> { <span class="hljs-comment">/* ... */</span> })
  .<span class="hljs-title function_">error</span>(<span class="hljs-number">418</span>, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> { <span class="hljs-comment">/* ... */</span> })
  .<span class="hljs-title function_">res</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> <span class="hljs-comment">/* ... */</span>)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> { <span class="hljs-comment">/* uncaught errors */</span> })</code></pre><h2 class="">2. ä»€ä¹ˆæ˜¯â€œç»Ÿä¸€å®ç°çš„è¯·æ±‚æ ¼å¼â€</h2><p>wretch æ— è®ºæ˜¯å‘é€ json æˆ– form-data äº¦æˆ– x-www-form-urlencoded éƒ½å¯ä»¥ç›´æ¥è°ƒç”¨ JS object å¯¹è±¡ã€‚</p><blockquote><div>So Sweet ğŸ¥°</div></blockquote><pre class="hljs"><code class="js hljs"><span class="hljs-keyword">const</span> form = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-number">2</span> } };

<span class="hljs-comment">// ğŸ“¤ application/json</span>
<span class="hljs-title function_">wretch</span>(<span class="hljs-string">&quot;...&quot;</span>).<span class="hljs-title function_">post</span>(form)

<span class="hljs-comment">// ğŸ“¤ multipart/form-data</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FormDataAddon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;wretch/addons/formData&quot;</span>
<span class="hljs-title function_">wretch</span>(<span class="hljs-string">&quot;...&quot;</span>).<span class="hljs-title function_">addon</span>(<span class="hljs-title class_">FormDataAddon</span>).<span class="hljs-title function_">formData</span>(form).<span class="hljs-title function_">post</span>();

<span class="hljs-comment">// ğŸ“¤ application/x-www-form-urlencoded</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FormUrlAddon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;wretch/addons/formUrl&quot;</span>
<span class="hljs-title function_">wretch</span>(<span class="hljs-string">&quot;...&quot;</span>).<span class="hljs-title function_">addon</span>(<span class="hljs-title class_">FormUrlAddon</span>).<span class="hljs-title function_">formUrl</span>(form).<span class="hljs-title function_">post</span>();</code></pre><p>fetch()</p><ol><li>å‘é€ json éœ€è¦ <code>JSON.stringify();</code></li><li>å‘é€ form-data éœ€è¦æ„å»º <code>new FormData();</code></li><li>å‘é€ x-www-form-urlencoded éœ€è¦ <code>new URLSearchParams();</code></li></ol><blockquote><div>Why? ğŸ˜µâ€ğŸ’«</div></blockquote><pre class="hljs"><code class="js hljs"><span class="hljs-keyword">const</span> data = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-number">2</span> } }

<span class="hljs-comment">// ğŸ“¤ application/json</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;endpoint&quot;</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span> }, <span class="hljs-comment">// 1ï¸âƒ£</span>
  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data) <span class="hljs-comment">// 2ï¸âƒ£</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> <span class="hljs-comment">/* ... */</span>)

<span class="hljs-comment">// ğŸ“¤ multipar/form-data</span>
<span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(); <span class="hljs-comment">// 1ï¸âƒ£</span>
formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-number">1</span>);
formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">c</span>: <span class="hljs-number">2</span>})); <span class="hljs-comment">// 2ï¸âƒ£</span>

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://example.com/submit&#x27;</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
    <span class="hljs-attr">body</span>: formData
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> <span class="hljs-comment">/* ... */</span>)

<span class="hljs-comment">// ğŸ“¤ application/x-www-form-urlencoded</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(); <span class="hljs-comment">// 1ï¸âƒ£</span>
data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-number">1</span>);
data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">c</span>: <span class="hljs-number">2</span>})); <span class="hljs-comment">// 2ï¸âƒ£</span>

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://example.com/submit&#x27;</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span> <span class="hljs-comment">// 3ï¸âƒ£</span>
    },
    <span class="hljs-attr">body</span>: data.<span class="hljs-title function_">toString</span>()() <span class="hljs-comment">// 4ï¸âƒ£</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> <span class="hljs-comment">/* ... */</span>)</code></pre><h2 class="">3. wretch æä¾›çš„â€œå¼€ç®±å³ç”¨çš„é«˜çº§åŠŸèƒ½â€</h2><p>wretch å®ç° retry åŠŸèƒ½ So Easy</p><pre class="hljs"><code class="js hljs"><span class="hljs-keyword">import</span> { retry } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;wretch/middlewares&quot;</span>

<span class="hljs-keyword">const</span> w = <span class="hljs-title function_">wretch</span>().<span class="hljs-title function_">middlewares</span>([<span class="hljs-title function_">retry</span>()])</code></pre><p>fetch() å®ç° retry åŠŸèƒ½ï¼ŒSo Hard</p><pre class="hljs"><code class="js hljs"><span class="hljs-comment">// generated by ChatGPT</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchWithRetry</span>(<span class="hljs-params">url, options = {}, retries = <span class="hljs-number">3</span>, delay = <span class="hljs-number">1000</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url, options)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
                <span class="hljs-keyword">if</span> (retries &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Retrying... <span class="hljs-subst">${retries}</span> attempts left.`</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
                        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">fetchWithRetry</span>(url, options, retries - <span class="hljs-number">1</span>, delay)), delay);
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Max retries reached, fetch failed.&#x27;</span>);
                }
            }
            <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>(); <span class="hljs-comment">// å¤„ç†è¿”å›çš„å“åº”ä½“ï¼ˆå‡è®¾æ˜¯ JSON æ ¼å¼ï¼‰</span>
        })
        .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (retries &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Retrying due to error: <span class="hljs-subst">${error.message}</span>, <span class="hljs-subst">${retries}</span> attempts left.`</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
                    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">fetchWithRetry</span>(url, options, retries - <span class="hljs-number">1</span>, delay)), delay);
                });
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Max retries reached, fetch failed: &#x27;</span> + error.<span class="hljs-property">message</span>);
            }
        });
}

<span class="hljs-comment">// è°ƒç”¨</span>
<span class="hljs-title function_">fetchWithRetry</span>(<span class="hljs-string">&#x27;https://example.com/api&#x27;</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;GET&#x27;</span> })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Success:&#x27;</span>, data))
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Error:&#x27;</span>, error));
</code></pre><p>æ›´ä¸ç”¨æ delay abort ç­‰é«˜çº§åŠŸèƒ½äº†ã€‚</p><h2 class="">æˆ‘å‘ç°çš„ wretch çš„ä¸€ç‚¹ç‚¹ä¸è¶³</h2><ol><li>progress ç‰¹æ€§ä»…æ”¯æŒ download <a class="tc-tiddlylink-external" href="https://github.com/elbywan/wretch/issues/225#issuecomment-2105633417" rel="noopener noreferrer" target="_blank">https://github.com/elbywan/wretch/issues/225#issuecomment-2105633417</a></li><li>æ²¡æœ‰å¼€ç®±å³ç”¨ Stream handler</li></ol><p>refs</p><ul><li><a class="tc-tiddlylink-external" href="https://github.com/elbywan/wretch" rel="noopener noreferrer" target="_blank">https://github.com/elbywan/wretch</a></li><li><a class="tc-tiddlylink-external" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API" rel="noopener noreferrer" target="_blank">https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API</a></li><li><a class="tc-tiddlylink-external" href="https://github.com/node-fetch/node-fetch" rel="noopener noreferrer" target="_blank">https://github.com/node-fetch/node-fetch</a></li><li><a class="tc-tiddlylink-external" href="https://github.com/axios/axios" rel="noopener noreferrer" target="_blank">https://github.com/axios/axios</a></li><li><a class="tc-tiddlylink-external" href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" rel="noopener noreferrer" target="_blank">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a></li></ul>
          </div>          
      </div>
  </div>
</div>     


<div class="copyright">
<strong>
<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">
ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²åï¼ˆåˆ›æ„å…±äº«3.0è®¸å¯è¯ï¼‰
</a>
</strong>
</div>

<style>
.copyright {
  padding: 0.5rem 1rem;
  text-align: center;
}

.copyright:hover {
  opacity: 0.9;
}
</style>


]]></description>
      <pubDate>Wed, 18 September 2024 7:45:32 -00:00</pubDate>
			<guid>https://thaddeusjiang.com/2024-09-18-js-wretch</guid>      
   </item>

</channel>
</rss>
