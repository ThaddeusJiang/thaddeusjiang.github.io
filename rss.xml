<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   <title>TJ (Thaddeus Jiang)</title>
   <link>https://thaddeusjiang.com</link>
   <description>ä¸“æ³¨ï¼›åˆ†äº«ï¼›å¯»æ‰¾ã€‚</description>
   <item>
      <title>2023-08-25 æœ€è¿‘å¸¸å¸¸è€ƒè™‘æ‰¾ä¸ªå¿ƒç†åŒ»ç”Ÿæ²»ç–—ä¸€ä¸‹</title>
      <link>https://thaddeusjiang.com/2023-08-25-zui-jin-chang-chang-kao-lv-zhao-ge-xin-li-yi-sheng-zhi-liao-yi-xia</link>
			<description><![CDATA[
<div class="container">
    <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2 my-4">
      <nav aria-label="main navigation" class="navbar" role="navigation">
        <div class="navbar-brand">
            <a href="./">
                <h1 class="title">TJ (Thaddeus Jiang)</h1>
                <p class="subtitle">ä¸“æ³¨ï¼›åˆ†äº«ï¼›å¯»æ‰¾ã€‚</p>
            </a>
        </div>
     </nav>
    </div>
  </div>


<div class="container mt-4">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2">
      <div>
          <div class="block content blog">
            <h1 class="subtitle">2023-08-25 æœ€è¿‘å¸¸å¸¸è€ƒè™‘æ‰¾ä¸ªå¿ƒç†åŒ»ç”Ÿæ²»ç–—ä¸€ä¸‹</h1>
            <hr>

            <p>æˆ‘æœ‰ä¸¤ä¸ªå¿ƒç»“ä¸€ç›´æ— æ³•è§£å¼€ï¼Œè™½ç„¶æˆ‘å¾ˆæƒ³æ”¾ä¸‹ï¼Œä½†æ˜¯å®ƒä»¬æ€»æ˜¯é—¯è¿›æˆ‘çš„æ¢¦å’Œå¤§è„‘é‡Œï¼Œè¶…çº§çƒ¦äººã€‚</p><p>ç¬¬ä¸€ä¸ªå¿ƒç»“æ˜¯ï¼šæˆ‘ç»å¸¸æ¢¦è§è‡ªå·±åœ¨å¤§å››ä»å¤§å­¦é€€å­¦ï¼Œå›é«˜ä¸­å¤è¯»å»äº†ï¼Œæ²¡æœ‰æ‹¿åˆ°å¤§å­¦æ¯•ä¸šè¯ã€‚</p><p>æˆ‘ç»å¸¸æ¢¦è§è‡ªå·±åœ¨å¤§å››ä»å¤§å­¦é€€å­¦ï¼Œå›é«˜ä¸­å¤è¯»å»äº†ï¼Œæ¢¦é‡Œæˆ‘æ€»æ˜¯é‚»è¿‘é«˜è€ƒæ‰å‘ç°è‡ªå·±ç°åœ¨çš„å®åŠ›è¿å¤§è¿ç†å·¥éƒ½è€ƒä¸ä¸Šäº†ï¼Œå¼€å§‹åæ‚”è‡ªå·±ä¸ºä»€ä¹ˆé€‰æ‹©å¤è¯»é‡æ–°é«˜è€ƒã€‚æ˜æ˜å·²ç»åœ¨å¤§å­¦è¯»äº†3å¹´ï¼Œæœ€åä¸€å¹´å®ä¹ ç»“æŸåå°±èƒ½ç¨³ç¨³åœ°æ‹¿åˆ°æ¯•ä¸šè¯è€Œè‡ªå·±å´æ”¾å¼ƒäº†ã€‚æ¯æ¬¡éƒ½è¢«è¿™ä¸ªæ¢¦æŠ˜è…¾åˆ°èº«å¿ƒç–²æƒ«ï¼Œæ¯æ¬¡éƒ½è¦åˆ°æ¢¦å¿«é†’çš„æ—¶å€™æˆ‘æ‰æ„è¯†åˆ°è‡ªå·±åœ¨ç°å®ä¸–ç•Œå…¶å®å·²ç»é¡ºåˆ©æ¯•ä¸šäº†ã€‚</p><p>ğŸ˜‚ ä½•å¿…å‘¢ï¼Ÿ</p><p>è™½ç„¶é†’ç€çš„æ—¶å€™æˆ‘è§‰å¾—è‡ªå·±å·²ç»æ”¾ä¸‹çš„å¤§å­¦å»äº†å¤§è¿ç†å·¥å¤§å­¦è½¯ä»¶å­¦é™¢è¿™ä¸ªå¿ƒç»“ï¼Œè€Œä¸”å­¦ä¹ è½¯ä»¶è²Œä¼¼æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ï¼Œå¸‚åœºéœ€æ±‚å¤§ï¼Œå¾…é‡é«˜ï¼Œè‡ªå·±ä¹Ÿæ“…é•¿ã€‚
ä½†æ˜¯åœ¨æ¢¦é‡Œå®ƒæ€»æ˜¯å‡ºç°ï¼Œæ€»æ¥æŠ˜ç£¨æˆ‘ï¼Œå¥½çƒ¦å•Šã€‚æˆ‘éƒ½å·²ç»ä»å¤§å­¦æ¯•ä¸š 8 å¹´äº†ï¼Œè€Œä¸”è¿™äº›å¹´å› ä¸ºå¤§è¿ç†å·¥ä¹Ÿç®—æ˜¯ä¸é”™çš„å­¦æ ¡ï¼Œè½¯ä»¶å·¥ç¨‹æ˜¯æ¯”è¾ƒæœ‰å¸‚åœºçš„ä¸“ä¸šï¼Œæˆ‘ä¹Ÿè¿‡çš„ä¸é”™ï¼Œæ²¡æœ‰è¿‡çš„å¾ˆæƒ¨ã€‚</p><p>ä¸ºä»€ä¹ˆæ¢¦é‡Œè¿™ä¸ªå¿ƒç»“æ€»æ¥æŠ˜ç£¨æˆ‘ï¼Œæˆ‘çœŸçš„æƒ³ä¸é€šã€‚é†’ç€çš„æ—¶å€™æˆ‘è§‰å¾—è‡ªå·±çœŸçš„å·²ç»ä¸ä»‹æ„äº†å•Šã€‚</p><p>æˆ‘çš„ç¬¬äºŒä¸ªå¿ƒç»“æ˜¯ï¼š</p><p>è¿™ä¸ªå¿ƒç»“æ¯”è¾ƒéšç§ï¼Œåªæœ‰æˆ‘è€å©†å’Œå‡ ä¸ªæœ‹å‹çŸ¥é“ï¼Œæˆ‘æš‚æ—¶è¿˜æ²¡æœ‰å‹‡æ°”è¯´å‡ºæ¥ã€‚å…¶å®æˆ‘å¾ˆæƒ³å’Œç°åœ¨å¸¸è”ç³»çš„å‡ ä¸ªæœ‹å‹èŠèŠè¿™ä¸ªå¿ƒç»“çš„ï¼Œä½†æ˜¯ç°åœ¨å¹´çºªå¤§äº†ï¼Œæ²¡æœ‰å¹´è½»æ—¶é‚£ä¹ˆå‹‡æ•¢äº†ï¼Œæ‰€ä»¥æœ‰æ—¶å€™è§‰å¾—å¹´çºªå¤§äº†ä»¥åæœ‹å‹ä¹‹é—´ä¹Ÿæœ‰ä¸èƒ½è¯´çš„ç§˜å¯†ã€‚æˆé•¿è®©äººå˜å¾—æ›´å­¤ç‹¬ï¼Œæ›´ä¸å¹¸ã€‚
æˆ‘è§‰å¾—å¾ˆçƒ¦ï¼Œæˆ‘ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½å…‹æœè¿™ä¸ªå¿ƒç»“ï¼Œè¯´ä¸å®šä¸€ç”Ÿéƒ½æ— æ³•å…‹æœå§ã€‚
æœ‰æ—¶æˆ‘å®‰æ…°è‡ªå·±ï¼Œå¦‚æœè¿™ä¸ªä¸–ç•Œè¶³å¤ŸåŒ…å®¹ï¼Œæ²¡æœ‰åœ£æ¯å©Šï¼Œæ²¡æœ‰é“å¾·è­¦å¯Ÿï¼Œè¿™ä¸ªå¿ƒç»“å…¶å®ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œæ²¡æœ‰ä¼¤å®³åˆ°ä»»ä½•äººï¼Œå¯¹æˆ‘è‡ªå·±ä¹Ÿæ²¡æœ‰ä»»ä½•è´Ÿé¢å½±å“ã€‚</p><blockquote><div>BTW æˆ‘ä¸æ˜¯åŒæ€§æ‹ï¼Œä¸ç”¨ççŒœï¼Œå“ˆå“ˆå“ˆ</div></blockquote><p>å®åœ¨ä¸è¡Œï¼ŒçœŸçš„åº”è¯¥å»å¯»æ±‚ä¸€ä¸‹å¿ƒç†æ²»ç–—ï¼Œè¦æ˜¯è¢«è¿™ä¸¤ä»¶ç ´äº‹ç»§ç»­æŠ˜ç£¨ä¸‹åˆå¯å¤ªçƒ¦äº†ã€‚</p><p>ä»¥ä¸Š
</p>
          </div>          
      </div>
  </div>
</div>     


]]></description>
      <pubDate>Fri, 25 August 2023 4:13:22 -00:00</pubDate>
			<guid>https://thaddeusjiang.com/2023-08-25-zui-jin-chang-chang-kao-lv-zhao-ge-xin-li-yi-sheng-zhi-liao-yi-xia</guid>      
   </item>

   <item>
      <title>2023-08-24 JS/TS number æ ¼æ ¼ä¸å…¥</title>
      <link>https://thaddeusjiang.com/2023-08-24-js-ts-number-ge-ge-bu-ru</link>
			<description><![CDATA[
<div class="container">
    <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2 my-4">
      <nav aria-label="main navigation" class="navbar" role="navigation">
        <div class="navbar-brand">
            <a href="./">
                <h1 class="title">TJ (Thaddeus Jiang)</h1>
                <p class="subtitle">ä¸“æ³¨ï¼›åˆ†äº«ï¼›å¯»æ‰¾ã€‚</p>
            </a>
        </div>
     </nav>
    </div>
  </div>


<div class="container mt-4">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2">
      <div>
          <div class="block content blog">
            <h1 class="subtitle">2023-08-24 JS/TS number æ ¼æ ¼ä¸å…¥</h1>
            <hr>

            <blockquote class="tc-quote tc-big-quote"><p>imo: TypeScript number ç±»å‹ä½œç”¨èŒƒå›´æ¨¡ç³Šï¼ŒJavaScript number å¾ˆå®¹æ˜“äº§ç”Ÿ bugï¼ŒES bigint é™åˆ¶å¤ªå¤šï¼Œlong.js èƒ½ä¸ç”¨å°±åˆ«ç”¨ã€‚
</p><cite>TJ</cite></blockquote><p>TypeScript çš„ number ç±»å‹å› ä¸ºéœ€è¦å…¼å®¹ JavaScriptï¼Œæ‰€ä»¥æ²¡æœ‰ int32 int64 ç­‰ç»†åˆ†ç±»å‹ï¼Œæ•°å€¼èŒƒå›´ä¹Ÿå’Œå…¶ä»–é™æ€è¯­è¨€ä¸ä¸€æ ·ï¼Œä½¿å¾— TypeScript number ä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€æ ¼æ ¼ä¸å…¥ã€‚</p><p>åˆ†äº«å‡ ä¸ªæˆ‘é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆï¼š</p><h3 class="">1. JS/TS number å…¨èº«éƒ½æ˜¯ bug</h3><p>JS/TS number å› ä¸ºè¦åŒæ—¶å…¼å®¹ int float double å¯¼è‡´å®ƒçš„ç²¾åº¦å¾ˆè¿·ï¼Œä¸å¼ºç±»å‹å·¥å…·ï¼ˆå¦‚ RDB, protobufï¼‰çš„æ•°å€¼èŒƒå›´ä¸Šæœ‰å·®å¼‚ï¼Œéå¸¸å®¹æ˜“äº§ç”Ÿ bugã€‚</p><p>JS æœ€å¤§å®‰å…¨æ•´æ•°ï¼ˆèƒ½å¤Ÿç²¾ç¡®è¡¨ç¤ºçš„æ•´æ•°ï¼‰ä¸º 9,007,199,254,740,991ï¼ˆ2<sup>53</sup> - 1ï¼‰ï¼Œè¿œå°äº int64 (2<sup>63</sup> - 1)ã€‚æ‰€ä»¥å¦‚æœä½ åœ¨ RDB ä¸­ä½¿ç”¨ int64 ç±»å‹ï¼Œåœ¨ JS ä¸­å°±ä¼šæº¢å‡ºã€‚</p><p>Example: 2<sup>64</sup>-1 is 1844674407370955<strong>1615</strong> but in JavaScript it evaluates to 1844674407370955<strong>2000</strong>.</p><blockquote><div>ä½¿ç”¨ long.js å¯ä»¥å¼¥è¡¥è¿™ä¸ªè®¾è®¡ç¼ºé™·ã€‚</div></blockquote><p>ä½†æ˜¯ long.js ä¹Ÿæœ‰é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šå’Œ bigint çš„é—®é¢˜ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸€èµ·è¯´ã€‚</p><h3 class="">2. JS/TS bigint é™åˆ¶è¶…å¤š</h3><p>bigint è™½ç„¶æ˜¯æ•´æ•°ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šæœ‰å¾ˆå¤šé™åˆ¶ï¼Œä¾‹å¦‚ï¼š</p><ol><li>BigInt ä¸ Number è½¬æ¢ä¼šæŸå¤±ç²¾åº¦</li><li>BigInt åœ¨ JSON.stringify() ä¼šå¼•å‘ TypeError</li><li>BigInt ä¸èƒ½ä½¿ç”¨ Math ä¸­æ–¹æ³•</li></ol><p>å¤©å‘ğŸ¤·ï¼Œè¿™ä¹ˆå¤šé™åˆ¶ï¼Œè¿˜ä¸å®¹ä¸ç”¨å‘¢ã€‚åæ­£æˆ‘ä»æ¥ä¸ç”¨ bigintã€‚</p><p>å¦‚æœçœŸçš„éœ€è¦å¤„ç†è¶…å¤§æ•°å€¼ï¼Œæˆ‘æ¨èä½¿ç”¨ bignumber.jsï¼Œæˆ‘å¯ä¸æƒ³è‡ªå·±å†™æ•°å€¼è¿ç®—ï¼Œbignumber.js æä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„æ–¹æ³•ï¼š</p><h2 class="">3. int32 int64 å¯¹åº” TS ç±»å‹æ²¡æœ‰ç»Ÿä¸€æ ‡å‡†</h2><p>Prisma scheme æ”¯æŒ BigInt ç±»å‹ï¼Œå¯¹åº” TS BigInt ç±»å‹</p><p>Protocol Buffers çš„ int32 int64 ç±»å‹åˆ†åˆ«å¯¹åº” TS number å’Œ Long</p><p>å¦‚æœä½ åŒæ—¶ä½¿ç”¨ Prisma BigInt å’Œ protobuf int64 çš„è¯ï¼Œä½ å¸¦ä»£ç ä¸­å°±ä¼šå‡ºç°å¤§é‡ç›¸äº’è½¬æ¢çš„ utilsï¼Œç±»ä¼¼ä¸‹é¢è¿™ç§ï¼š</p><blockquote><div>ğŸ‘‡è¿™äº›ä»£ç éƒ½æ˜¯æˆ‘ä»å…¶ä»–äººçš„ä»£ç ä¸­ copy è¿‡æ¥çš„ï¼Œä¸æ˜¯æˆ‘å†™çš„ï¼Œæˆ‘ä¹Ÿæ°¸è¿œä¸ç”¨å†™è¿™ç§ä»£ç ã€‚</div></blockquote><pre class="hljs"><code class="ts hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigIntUtil</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">toNumber</span>(<span class="hljs-attr">b</span>: bigint): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">const</span> n = <span class="hljs-built_in">parseInt</span>(b.<span class="hljs-title function_">toString</span>());
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isSafeInteger</span>(n)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
        <span class="hljs-string">&#x27;Fail to cast bigint to number. Value is out of safe integer range.&#x27;</span>,
      );
    }
    <span class="hljs-keyword">return</span> n;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">from</span>(<span class="hljs-attr">v</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | bigint): bigint {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> v === <span class="hljs-string">&#x27;bigint&#x27;</span>) {
      <span class="hljs-keyword">return</span> v;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">BigInt</span>(v);
  }
}</code></pre><pre class="hljs"><code class="ts hljs"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Long</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;long&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongUtil</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromBigInt</span>(<span class="hljs-attr">num</span>: bigint): <span class="hljs-title class_">Long</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromBigInt</span>(<span class="hljs-attr">num</span>: bigint | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>): <span class="hljs-title class_">Long</span> | <span class="hljs-literal">undefined</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromBigInt</span>(<span class="hljs-attr">num</span>: bigint | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>): <span class="hljs-title class_">Long</span> | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">if</span> (num === <span class="hljs-literal">undefined</span> || num === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Long</span>.<span class="hljs-title function_">fromNumber</span>(<span class="hljs-title class_">Number</span>(num));
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">toBigInt</span>(<span class="hljs-attr">num</span>: <span class="hljs-title class_">Long</span>): bigint;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">toBigInt</span>(<span class="hljs-attr">num</span>: <span class="hljs-title class_">Long</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>): bigint | <span class="hljs-literal">undefined</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">toBigInt</span>(<span class="hljs-attr">num</span>: <span class="hljs-title class_">Long</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>): bigint | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">if</span> (num === <span class="hljs-literal">undefined</span> || num === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">BigInt</span>(num.<span class="hljs-title function_">toNumber</span>());
  }
}</code></pre><pre class="hljs"><code class="ts hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonUtil</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">stringify</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data, <span class="hljs-function">(<span class="hljs-params">k, v</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> v === <span class="hljs-string">&#x27;bigint&#x27;</span>) {
        <span class="hljs-keyword">return</span> v.<span class="hljs-title function_">toString</span>();
      }
      <span class="hljs-keyword">return</span> v;
    });
  }
}</code></pre><p>ä½ æœ‰å…³äº JS/TS number çš„æ•…äº‹å—ï¼Ÿæ¬¢è¿ä¸æˆ‘åˆ†äº«ã€‚</p><p>refs:</p><ul><li><a class="tc-tiddlylink-external" href="https://www.npmjs.com/package/long" rel="noopener noreferrer" target="_blank">long.js</a></li><li><a class="tc-tiddlylink-external" href="https://www.npmjs.com/package/bignumber.js" rel="noopener noreferrer" target="_blank">bignumber.js</a></li><li><a class="tc-tiddlylink-external" href="https://www.prisma.io/docs/concepts/components/prisma-client/working-with-fields#working-with-bigint" rel="noopener noreferrer" target="_blank">Prisma BigInt</a></li><li><a class="tc-tiddlylink-external" href="https://protobuf.dev/programming-guides/proto3/" rel="noopener noreferrer" target="_blank">protobuf int64</a></li></ul>
          </div>          
      </div>
  </div>
</div>     


]]></description>
      <pubDate>Thu, 24 August 2023 13:44:6 -00:00</pubDate>
			<guid>https://thaddeusjiang.com/2023-08-24-js-ts-number-ge-ge-bu-ru</guid>      
   </item>

   <item>
      <title>2023-08-22 error handling</title>
      <link>https://thaddeusjiang.com/2023-08-22-error-handling</link>
			<description><![CDATA[
<div class="container">
    <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2 my-4">
      <nav aria-label="main navigation" class="navbar" role="navigation">
        <div class="navbar-brand">
            <a href="./">
                <h1 class="title">TJ (Thaddeus Jiang)</h1>
                <p class="subtitle">ä¸“æ³¨ï¼›åˆ†äº«ï¼›å¯»æ‰¾ã€‚</p>
            </a>
        </div>
     </nav>
    </div>
  </div>


<div class="container mt-4">
  <div class="column is-6-desktop is-offset-3-desktop is-8 is-offset-2">
      <div>
          <div class="block content blog">
            <h1 class="subtitle">2023-08-22 error handling</h1>
            <hr>

            <p>å¯¹äº error handlingï¼Œæˆ‘çš„é£æ ¼ç¢°å·§å’Œ Ruby ä½œè€… Matz ä¸€è‡´ï¼Œè™½ç„¶æ˜¯å·§åˆï¼Œä½†æ˜¯å¢åŠ äº†æˆ‘çš„ä¿¡å¿ƒã€‚</p><p>å…ˆè¯´ error handling éœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ</p><ol><li>ä¸èƒ½æ”¾ä»» error ä½¿å…¶å¯¼è‡´ç¨‹åºå´©æºƒ</li><li>ä¸èƒ½è®© error handling å¤šåˆ°å½±å“åŸæœ¬çš„åŠŸèƒ½</li></ol><p>æˆ‘å¸¸ç”¨çš„ç¼–ç¨‹è¯­è¨€æœ‰ TypeScript å’Œ Elixirï¼ŒElixir ä¸ç”¨è¯´äº†ï¼Œæˆ‘å¾ˆå–œæ¬¢å®ƒçš„ error handling æœºåˆ¶ã€‚</p><p>æˆ‘ä¸»è¦åˆ†äº«ä¸€ä¸‹æˆ‘è‡ªå·±ä½¿ç”¨ TypeScript æ—¶çš„ error handling é£æ ¼ã€‚</p><h3 class="">1. 80% çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¼šç›´æ¥ä½¿ç”¨ try-catch å¤„ç† Exceptionï¼Œä¸ç”¨å…¶ä»–å¥‡æŠ€æ·«å·§</h3><h3 class="">2. æˆ‘ä¼šå°½é‡é¿å… Nested try blocksï¼Œå½¢å¦‚ï¼š</h3><pre class="hljs"><code class="js hljs"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;oops&quot;</span>);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;finally&quot;</span>);
  }
} <span class="hljs-keyword">catch</span> (ex) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;outer&quot;</span>, ex.<span class="hljs-property">message</span>);
}</code></pre><p>ä¸ºäº†é¿å…åµŒå¥— try blocksï¼Œæˆ‘ä¼šå‚è€ƒ Elixir/golang/Swift çš„æ–¹å¼è¿”å›ä¸€ä¸ªæ•°ç»„åŒ…å« [isError, data/error]</p><p>å½¢å¦‚ï¼š</p><pre class="hljs"><code class="js hljs"><span class="hljs-comment">// </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> [<span class="hljs-literal">false</span>, data]
  } <span class="hljs-keyword">catch</span>(error) {
    <span class="hljs-keyword">return</span> [<span class="hljs-literal">true</span>, error]
  }
}

<span class="hljs-keyword">const</span> [isError, data] = <span class="hljs-title function_">doSomething</span>()
<span class="hljs-keyword">if</span>(isError) {
  <span class="hljs-comment">// data is error</span>
  <span class="hljs-comment">// your fallback</span>
}
<span class="hljs-comment">// data is expected data</span>
<span class="hljs-comment">// next ...</span></code></pre><p>supabase-js å’Œ zod ä¹Ÿé‡‡ç”¨äº†ç±»ä¼¼çš„é£æ ¼ï¼Œåªæ˜¯ç»†èŠ‚ä¸å¤ªä¸€æ ·ï¼Œè¿™ä¹Ÿå¢å¼ºäº†æˆ‘çš„ä¿¡å¿ƒã€‚</p><pre class="hljs"><code class="js hljs"><span class="hljs-comment">// supabase-js </span>
<span class="hljs-keyword">const</span> { data, error } = <span class="hljs-keyword">await</span> supabase
  .<span class="hljs-title function_">from</span>(<span class="hljs-string">&#x27;countries&#x27;</span>)
  .<span class="hljs-title function_">select</span>()</code></pre><pre class="hljs"><code class="js hljs"><span class="hljs-comment">// zod .safeParse</span>
stringSchema.<span class="hljs-title function_">safeParse</span>(<span class="hljs-number">12</span>);
<span class="hljs-comment">// =&gt; { success: false; error: ZodError }</span>

stringSchema.<span class="hljs-title function_">safeParse</span>(<span class="hljs-string">&quot;billie&quot;</span>);
<span class="hljs-comment">// =&gt; { success: true; data: &#x27;billie&#x27; }</span></code></pre><p>ä¸ºä»€ä¹ˆæˆ‘ç”¨ Array è€Œä¸æ˜¯ Object ä½œä¸ºè¿”å›å€¼ï¼Ÿå› ä¸ºæˆ‘è§‰å¾— ES6 ä»¥åæ•°ç»„å–å€¼ä¹Ÿå¾ˆç®€å•ã€‚</p><h3 class="">3. æˆ‘ä¸ä¼šå¼ºè¿«ç—‡ä¼¼çš„ç©·ä¸¾æ‰€æœ‰çš„ Exception ç±»å‹</h3><pre class="hljs"><code class="js hljs"><span class="hljs-comment">// good</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Data</span>&gt;

<span class="hljs-comment">// bad</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Data</span> 
      | <span class="hljs-title class_">RpcException</span>
      | <span class="hljs-title class_">ChargeFeeHasNotBeenPaidException</span>
      | <span class="hljs-title class_">BadRequestException</span>
      | <span class="hljs-title class_">UnusableFacilityException</span>
      | <span class="hljs-title class_">NotBusinessDayException</span>&gt;</code></pre><p>å½“ç„¶ï¼Œnpm package, public library é™¤å¤–ã€‚</p><h3 class="">4. æˆ‘ä¸ä¼šè®© Exception ä¸èƒ½å¯¼è‡´æ•´ä¸ª App å´©æºƒ</h3><p>MVC é£æ ¼çš„ web server app çš„ exception æœ€å¥½æ§åˆ¶åœ¨ controller å±‚ï¼Œä¸è¦å› ä¸ºä¸ªåˆ«çš„ API å¼‚å¸¸å¯¼è‡´æ•´ä¸ª App å´©æºƒæˆ–è€…é‡å¯ã€‚</p><p>ç±»ä¼¼ Remix.run è¿™æ ·çš„æ¡†æ¶ç”šè‡³å¯ä»¥å°† exception æ§åˆ¶åœ¨ UI component çº§åˆ«ï¼Œä¸è¿‡æˆ‘ä¸è¿‡åˆ†å¼ºæ±‚ï¼Œåªè¦åˆ«è®©æ•´ä¸ª App å´©æºƒå°±è¡Œã€‚</p><h3 class="">5. æˆ‘ä¼šé€‚å½“è®°å½• Exception log</h3><p>refs</p><ul><li><a class="tc-tiddlylink-external" href="https://supabase.com/docs/reference/javascript/select" rel="noopener noreferrer" target="_blank">supabse-js error handling</a></li><li><a class="tc-tiddlylink-external" href="https://zod.dev/?id=safeparse" rel="noopener noreferrer" target="_blank">zod.dev error handling</a></li></ul><p>å¤‡æ³¨ï¼š</p><blockquote><div>è¿™æ˜¯æˆ‘çš„ä¸ªäººé£æ ¼ï¼Œä¸å¥¢æ±‚æˆä¸ºä¸»æµï¼Œåªå¸Œæœ›å°†æ¥æœ‰æœºä¼šåˆä½œçš„æœ‹å‹èƒ½äº‹å…ˆäº†è§£æˆ‘çš„ä¸ªäººé£æ ¼ã€‚</div></blockquote>
          </div>          
      </div>
  </div>
</div>     


]]></description>
      <pubDate>Tue, 22 August 2023 1:13:55 -00:00</pubDate>
			<guid>https://thaddeusjiang.com/2023-08-22-error-handling</guid>      
   </item>

</channel>
</rss>
